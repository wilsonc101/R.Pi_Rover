<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Leaflet</title>
  
  <link rel="stylesheet" type="text/css" href="leaflet-0.7.2/leaflet.css">
  <link rel="stylesheet" type="text/css" href="leafdraw/leaflet.draw.css">
  <script type='text/javascript' src="leaflet-0.7.2/leaflet.js"></script>
  <script type='text/javascript' src="jquery/jquery.min.js"></script>
  <script type='text/javascript' src="leafdraw/leaflet.draw.js"></script>
      
  <style type='text/css'>
    html, body, #map {
    width:100%;
    height:100%;
    margin:0;
    padding:0;}

   .get-markers {
     width:100%;
     margin:10px 0;}
  </style>
  

<script type='text/javascript'>//<![CDATA[
window.onload=function(){


var postURL = "http://localhost:8080";

function generateUUID(){
    var d = new Date().getTime();
    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (d + Math.random()*16)%16 | 0;
        d = Math.floor(d/16);
        return (c=='x' ? r : (r&0x3|0x8)).toString(16);
    });
    return uuid;
}

function httpPOST(action, type, id, data){
    post_data = '{"action":"' + action + '", "type":"' + type + '", "id":"' + id + '", "data":' + data + '}';
    xhttp = new XMLHttpRequest();
    xhttp.open("POST", postURL, true);
    xhttp.send(post_data);
}

// Add OSM tile layer (attrib)
var osmUrl = 'data/{id}/{z}/{x}/{y}.{ex}',
    osmAttrib = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';


// initialize map and set default layer and location
var sat = L.tileLayer(osmUrl, {id: 'mapquest-open-aerial', ex: 'jpg', attribution: osmAttrib}),
    streets = L.tileLayer(osmUrl, {id: 'openstreetmap',   ex: 'png', attribution: osmAttrib});

var map = L.map('map', {center: [51.44667890937984, -2.1424198150634766], 
                        zoom: 16}).addLayer(streets);

// Create layer menu and assign to map
var baseLayers = {"Satellite": sat,
                  "Streets": streets};

L.control.layers(baseLayers).addTo(map);






// Initialise the FeatureGroup to store editable layers
var drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

// Initialise the draw control and pass it the FeatureGroup of editable layers
var drawControl = new L.Control.Draw({
    edit: {
        featureGroup: drawnItems
    }
});
map.addControl(drawControl);

var test1 = L.marker([51.44598349055138,-2.1436643600463867]);
drawnItems.addLayer(test1);

map.on('draw:created', function (e) {
    var type = e.layerType,
        layer = e.layer;

    layer._leaflet_id = generateUUID();
    httpPOST("create", type, layer._leaflet_id, JSON.stringify(layer.toGeoJSON()));

    drawnItems.addLayer(layer);
});

map.on('draw:deleted', function (e) {
    var layergroup = e.layers;

    layergroup.eachLayer(function (layer) {
        var type = layer.type;
        httpPOST("delete", "None", layer._leaflet_id, JSON.stringify(layer.toGeoJSON()));
    });   

});


}//]]> 


</script>

</head>
<body>
<div id="map" data-mode="">
    <input type="hidden" data-map-markers="" value="" name="map-geojson-data" />
</div>

  
</body>

</html>


